<header class="app-header">
  <div class="header-brand">
    <div class="brand-mark">
      <img
        class="brand-logo"
        src="https://www.navitrans.com.co/wp-content/uploads/2025/01/logoblanco-navitrans-scaled-2048x569.webp"
        alt="Navitrans"
      />
    </div>
    <div class="brand-text">
      <span class="brand-title">PartsFinder Pro</span>
      <span class="brand-subtitle">Sistema de Catalogo Inteligente</span>
    </div>
  </div>

  <div class="header-tools">
    <button class="theme-toggle" type="button" (click)="toggleTheme()" [attr.aria-pressed]="theme === 'dark'">
      <lucide-icon [img]="themeIcon" [size]="18"></lucide-icon>
      <span class="theme-label">{{ theme === 'dark' ? 'Light' : 'Dark' }}</span>
    </button>

    <div class="user-menu" [class.open]="isUserMenuOpen">
      <button class="user-trigger" type="button" (click)="toggleUserMenu($event)">
        <lucide-icon [img]="UserIcon" [size]="18"></lucide-icon>
        <span class="user-name">{{ currentUser?.name || 'Usuario' }}</span>
        <lucide-icon [img]="ChevronDown" [size]="16"></lucide-icon>
      </button>

      <div class="user-dropdown" *ngIf="isUserMenuOpen">
        <div class="user-meta">
          <div class="user-title">{{ currentUser?.name }}</div>
          <div class="user-role">{{ currentUser?.role }}</div>
        </div>

        <div class="menu-actions">
          <button *ngIf="canImport" type="button" (click)="openImportModal()">
            <lucide-icon [img]="Upload" [size]="16"></lucide-icon>
            Importar Datos
          </button>
          <button *ngIf="canImport" type="button" (click)="openImageUploadModal()">
            <lucide-icon [img]="Image" [size]="16"></lucide-icon>
            Subir Imagen
          </button>
          <button *ngIf="canManageUsers" type="button" (click)="goToUsers()">
            <lucide-icon [img]="Users" [size]="16"></lucide-icon>
            Usuarios
          </button>
        </div>

        <button class="logout-button" type="button" (click)="logout()">
          Cerrar sesion
        </button>
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div *ngIf="message" class="notification-toast"
    [ngClass]="{
         'notification-info': message.type === 'loading',
         'notification-success': message.type === 'success',
         'notification-error': message.type === 'error'
       }">
    <div class="flex items-start gap-3">
      <div *ngIf="message.type === 'loading'" class="flex items-center">
        <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
      </div>
      <p class="text-sm font-medium flex-1">{{ message.text }}</p>
    </div>
  </div>
</header>

<app-image-upload-modal [isOpen]="showImageModal" (close)="closeImageUploadModal()" (imageUploaded)="onImageUploaded()">
</app-image-upload-modal>

<app-import-data-modal [isOpen]="showImportModal" (close)="closeImportModal()" (importSuccess)="onImportSuccess($event)">
</app-import-data-modal>
