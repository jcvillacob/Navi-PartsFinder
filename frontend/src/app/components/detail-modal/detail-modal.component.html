<div class="fixed inset-0 z-50 flex items-center justify-center p-4" *ngIf="isOpen">
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm" (click)="onClose()"></div>

  <!-- Modal Content -->
  <div
    class="relative bg-slate-900 border border-indigo-500/30 rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in duration-200">

    <!-- Header -->
    <div class="bg-indigo-900/20 px-6 py-4 border-b border-indigo-900/30 flex justify-between items-center">
      <h3 class="text-xl font-bold text-white flex items-center gap-2">
        <lucide-icon [img]="Package" [size]="20" class="text-emerald-400"></lucide-icon>
        Disponibilidad de Inventario
      </h3>
      <button (click)="onClose()"
        class="text-slate-400 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-full">
        <lucide-icon [img]="X" [size]="20"></lucide-icon>
      </button>
    </div>

    <!-- Body -->
    <div class="p-6 space-y-6">

      <!-- Loading State -->
      <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-12">
        <lucide-icon [img]="Loader2" [size]="40" class="text-indigo-400 animate-spin"></lucide-icon>
        <p class="text-slate-400 mt-4">Consultando inventario...</p>
      </div>

      <!-- Content -->
      <ng-container *ngIf="!isLoading">
        <!-- Main Info -->
        <div class="flex items-center justify-between pb-4 border-b border-indigo-900/30">
          <div class="flex flex-col gap-1">
            <span class="text-xs text-indigo-300 uppercase tracking-wider font-semibold">Referencia</span>
            <span class="text-2xl font-mono font-bold text-emerald-400">{{ partNumber }}</span>
          </div>
          <div class="flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border"
            [ngClass]="isAvailable ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' : 'bg-red-500/10 text-red-400 border-red-500/20'">
            <lucide-icon [img]="isAvailable ? CheckCircle2 : XCircle" [size]="18"></lucide-icon>
            {{ isAvailable ? 'Disponible' : 'No Disponible' }}
          </div>
        </div>

        <!-- Total Summary -->
        <div class="bg-slate-800/30 rounded-xl p-4 border border-slate-700/30 flex items-center justify-between"
          *ngIf="isAvailable">
          <span class="text-slate-300 flex items-center gap-2">
            <lucide-icon [img]="Package" [size]="18" class="text-indigo-400"></lucide-icon>
            Total Disponible
          </span>
          <span class="text-2xl font-mono font-bold text-white">{{ totalQuantity }} <span
              class="text-sm text-slate-400 font-normal">Unidades</span></span>
        </div>

        <!-- Locations Table -->
        <div *ngIf="isAvailable && locations.length > 0" class="space-y-3">
          <h4 class="text-sm font-semibold text-indigo-300 uppercase tracking-wider flex items-center gap-2">
            <lucide-icon [img]="MapPin" [size]="16"></lucide-icon>
            Disponibilidad por Sede
          </h4>
          <div class="bg-slate-800/20 rounded-xl border border-slate-700/30 overflow-hidden">
            <div class="max-h-64 overflow-auto custom-scrollbar">
              <table class="w-full text-sm">
                <thead class="bg-slate-800/50 sticky top-0">
                  <tr class="text-xs uppercase text-slate-400 tracking-wider">
                    <th class="px-4 py-3 text-left">Sede</th>
                    <th class="px-4 py-3 text-left">Zona</th>
                    <th class="px-4 py-3 text-left">Almac√©n</th>
                    <th class="px-4 py-3 text-right">Cantidad</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-slate-700/30">
                  <tr *ngFor="let loc of locations" class="hover:bg-indigo-900/10 transition-colors">
                    <td class="px-4 py-3 text-white font-medium">{{ loc.sede }}</td>
                    <td class="px-4 py-3 text-slate-300">{{ loc.zona }}</td>
                    <td class="px-4 py-3 text-slate-400 font-mono">{{ loc.almacen }}</td>
                    <td class="px-4 py-3 text-right">
                      <span class="text-emerald-400 font-bold font-mono">{{ loc.cantidad }}</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- No Stock Message -->
        <div *ngIf="!isAvailable"
          class="bg-red-500/5 border border-red-500/20 rounded-xl p-6 text-center">
          <lucide-icon [img]="XCircle" [size]="40" class="text-red-400 mx-auto mb-3"></lucide-icon>
          <p class="text-slate-300">No hay stock disponible para esta referencia en ninguna sede.</p>
        </div>
      </ng-container>

    </div>

    <!-- Footer -->
    <div class="bg-slate-950/30 px-6 py-4 border-t border-indigo-900/30 flex justify-end">
      <button (click)="onClose()"
        class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg transition-colors font-medium text-sm">
        Cerrar
      </button>
    </div>

  </div>
</div>